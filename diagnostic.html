<!DOCTYPE html>
<html>
<head>
    <title>System Diagnostic</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #0f0; }
        .check { margin: 10px 0; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        .warn { color: #ff0; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç System Diagnostic</h1>
    
    <div class="section">
        <h2>Browser Status</h2>
        <div class="check" id="check1"></div>
        <div class="check" id="check2"></div>
        <div class="check" id="check3"></div>
        <div class="check" id="check4"></div>
    </div>
    
    <div class="section">
        <h2>localStorage Contents</h2>
        <pre id="storage"></pre>
    </div>
    
    <div class="section">
        <h2>API Tests</h2>
        <div class="check" id="api1"></div>
        <div class="check" id="api2"></div>
        <div class="check" id="api3"></div>
    </div>
    
    <script>
        // Check 1: localStorage
        const hasToken = localStorage.getItem('token');
        const hasUser = localStorage.getItem('currentUser');
        document.getElementById('check1').innerHTML = (hasToken ? '<span class="pass">‚úì</span>' : '<span class="fail">‚úó</span>') + ' Token in localStorage: ' + (hasToken ? 'YES' : 'NO');
        document.getElementById('check2').innerHTML = (hasUser ? '<span class="pass">‚úì</span>' : '<span class="fail">‚úó</span>') + ' User in localStorage: ' + (hasUser ? 'YES' : 'NO');
        
        if (hasUser) {
            try {
                const user = JSON.parse(hasUser);
                document.getElementById('check3').innerHTML = '<span class="pass">‚úì</span> User parsed: ' + user.name + ' (' + user.role + ')';
            } catch(e) {
                document.getElementById('check3').innerHTML = '<span class="fail">‚úó</span> User parse error: ' + e.message;
            }
        }
        
        // Storage dump
        let storage = 'localStorage contents:\n\n';
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            let value = localStorage.getItem(key);
            if (key === 'token') {
                value = value.substring(0, 20) + '...';
            } else if (key === 'currentUser') {
                try {
                    value = JSON.stringify(JSON.parse(value), null, 2);
                } catch(e) {}
            }
            storage += `${key}: ${value}\n`;
        }
        document.getElementById('storage').textContent = storage;
        
        // API Tests
        async function testApi() {
            const token = localStorage.getItem('token');
            
            if (!token) {
                document.getElementById('api1').innerHTML = '<span class="fail">‚úó</span> No token found - need to login first';
                return;
            }
            
            // Test employees
            try {
                const resp = await fetch('http://localhost:5002/api/employees', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await resp.json();
                if (Array.isArray(data)) {
                    document.getElementById('api1').innerHTML = '<span class="pass">‚úì</span> Employees endpoint: ' + data.length + ' employees found';
                } else {
                    document.getElementById('api1').innerHTML = '<span class="fail">‚úó</span> Employees endpoint returned invalid data';
                }
            } catch(e) {
                document.getElementById('api1').innerHTML = '<span class="fail">‚úó</span> Employees endpoint error: ' + e.message;
            }
            
            // Test password logs
            try {
                const resp = await fetch('http://localhost:5002/api/password-logs', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await resp.json();
                if (Array.isArray(data)) {
                    document.getElementById('api2').innerHTML = '<span class="pass">‚úì</span> Password logs: ' + data.length + ' logs found';
                } else {
                    document.getElementById('api2').innerHTML = '<span class="warn">‚ö†</span> Password logs: empty or invalid';
                }
            } catch(e) {
                document.getElementById('api2').innerHTML = '<span class="fail">‚úó</span> Password logs error: ' + e.message;
            }
            
            // Test login logs
            try {
                const resp = await fetch('http://localhost:5002/api/login-logs', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await resp.json();
                if (Array.isArray(data)) {
                    document.getElementById('api3').innerHTML = '<span class="pass">‚úì</span> Login logs: ' + data.length + ' logs found';
                } else {
                    document.getElementById('api3').innerHTML = '<span class="warn">‚ö†</span> Login logs: empty or invalid';
                }
            } catch(e) {
                document.getElementById('api3').innerHTML = '<span class="fail">‚úó</span> Login logs error: ' + e.message;
            }
        }
        
        // Run tests
        window.setTimeout(testApi, 500);
    </script>
</body>
</html>
